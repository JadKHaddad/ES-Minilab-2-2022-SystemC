#ifndef CONTROLLER
#define CONTROLLER

#include <systemc.h>
#include "const.hpp"
#include "helpers.hpp"

SC_MODULE( Controller )
{
  //attributes
  int real_world_map[N][N] = { //N=10
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   99,	99,	99,	99,	99,	00,	00,	99,	99,	99  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00  }
  };
/*
  int real_world_map[N][N] = { //N=20
  {   00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	99,	00,	00,	00,	99,	99,	99,	99,	99,	99,	99,	00,	00,	99,	99,	99  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	00,	00  },
  {   00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	00,	00  },
  {   99,	99,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	00,	00  },
  {   99,	99,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   99,	99,	00,	00,	99,	00,	00,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   99,	99,	00,	00,	99,	00,	00,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	99,	00,	00,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99  },
  {   00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99  },
  {   00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99  },
  {   00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99  }
  };
*/
/*
  int real_world_map[N][N] = { //N=50
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00  },
  {   99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99,	99  },
  {   00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  },
  {   00,	00,	00,	00,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	99,	99,	99,	99,	99,	99,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	99,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00,	00  }
  };
*/
  int map[N][N];

  sc_in<bool> clk;
  sc_uint<16> working_drones_count = 0;
  sc_uint<16> came_back_drones_cout = 0;
  sc_uint<16> index = 0;
  sc_uint<16> index_limit = 1;
  sc_uint<16> batt_in_sec = 20 * 60; //20 mins

  Pos drones_positions[DRONE_COUNT];
  Pos free_positions[N*N];

  sc_out <sc_int<16>> travel_dist_out[DRONE_COUNT];

  sc_in<bool> ready_in[DRONE_COUNT];
  sc_in<bool> vld_in[DRONE_COUNT];

  sc_out<bool> ready_out[DRONE_COUNT];
  sc_out<bool> vld_out[DRONE_COUNT];

  //methods
  void source(); //decides which drone travells to wich location and calculates travell distance
  void sink(); //receives signals from the drones and updates the locations that can be discovered
  void guard(); //stops the simulation in case of a dead lock - the programms output may not be predictable with wrong parameters
  void expand_path(Pos new_pos); //adds new locations to the path that can be discovered after a nearby location has been discovered
  void print_map(); //prints the map
  void print_real_world_map(); //prints the real world map
  void print_free_positions(); //prints path - free positions that can be discovered
  IndexDist get_index_and_dist_of_a_free_drone(Pos dest); //returns the index of a drone with the minimal distance to a given position on the map - returns -1 if there is no free path

  SC_CTOR( Controller )
  {
    //init map
    for(int i = 0; i < DRONE_COUNT; ++i)
    {
      drones_positions[i] = Pos();
    }
    for(int i = 0; i < N; ++i)
    {
      for(int j = 0; j < N; ++j)
      {
        map[i][j] = 0;
      }
    }
    //init free positions
    for(int i = 0; i < N*N; ++i)
    {
      free_positions[i] = Pos();
    }
    SC_CTHREAD(source, clk.pos());
    SC_CTHREAD(sink, clk.pos());
    SC_CTHREAD(guard, clk.pos());
  }
};

#endif